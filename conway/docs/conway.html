<!DOCTYPE html>  <html> <head>   <title>conway.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               conway.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>Conway's Game of Life</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p><img src="glider.png" alt="glider.png" title="" /></p>

<p>The universe of the Game of Life is an infinite two-dimensional orthogonal
grid of square cells, each of which is in one of two possible states, live or
dead.  Every cell interacts with its eight neighbors, which are the cells that
are horizontally, vertically, or diagonally adjacent. At each step in time, the
following transitions occur:</p>

<ul>
<li>Any live cell with fewer than two live neighbors dies, as if caused by
under-population.</li>
<li>Any live cell with two or three live neighbors lives on to
the next generation.</li>
<li>Any live cell with more than three live neighbors dies,
as if by overcrowding.</li>
<li>Any dead cell with exactly three live neighbors
becomes a live cell, as if by reproduction.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The initial pattern constitutes the seed of the system. The first generation is
created by applying the above rules simultaneously to every cell in the
seed -- births and deaths occur simultaneously, and the discrete moment at
which this happens is sometimes called a tick (in other words, each generation
is a pure function of the preceding one). The rules continue to be applied
repeatedly to create further generations.</p>

<p><em><a href="http://en.wikipedia.org/wiki/Conway's_Game_of_Life#Algorithms">full article on wikipedia</a></em></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">GameOfLife</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>number of rows and columns to populate</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">gridSize: </span><span class="mi">50</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>size of the canvas</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">canvasSize: </span><span class="mi">600</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>color to use for the lines on the grid</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">lineColor: </span><span class="s1">&#39;#cdcdcd&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>color to use for live cells on the grid</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">liveColor: </span><span class="s1">&#39;#666&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>color to use for dead cells on the grid</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">deadColor: </span><span class="s1">&#39;#eee&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>initial probability that a given cell will be live</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialLifeProbability: </span><span class="mf">0.5</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>how fast to redraw the world in milliseconds</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">animationRate: </span><span class="mi">60</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>In the constructor for the GameOfLife class we extend the game with any
passed in options, set the initial state of the world, and start the
circleOfLife.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(options = {}) -&gt;</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span> <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">options</span>
    <span class="vi">@world    = </span><span class="nx">@createWorld</span><span class="p">()</span>
    <span class="nx">do</span> <span class="nx">@circleOfLife</span>
    <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>We iterate the world passing a callback that populates it with initial
organisms based on the initialLifeProbability.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">createWorld: </span><span class="o">-&gt;</span>
    <span class="nx">@travelWorld</span> <span class="p">(</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">cell.live = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="nx">@initialLifeProbability</span>
      <span class="nx">cell</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>This is the main run loop for the game. At each step we iterate through
the world drawing each cell and resolving the next generation for that
cell. The results of this process become the state of the world for the
next generation.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">circleOfLife: </span><span class="o">=&gt;</span>
    <span class="vi">@world = </span><span class="nx">@travelWorld</span> <span class="p">(</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">cell = </span><span class="nx">@world</span><span class="p">[</span><span class="nx">cell</span><span class="p">.</span><span class="nx">row</span><span class="p">][</span><span class="nx">cell</span><span class="p">.</span><span class="nx">col</span><span class="p">]</span>
      <span class="nx">@draw</span> <span class="nx">cell</span>
      <span class="nx">@resolveNextGeneration</span> <span class="nx">cell</span>
    <span class="nx">setTimeout</span> <span class="nx">@circleOfLife</span><span class="p">,</span> <span class="nx">@animationRate</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Given a cell we determine if it should be live or dead in the next
generation based on Conway's rules.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">resolveNextGeneration: </span><span class="nf">(cell) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Determine the number of living neighbors.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">count = </span><span class="nx">@countNeighbors</span> <span class="nx">cell</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Make a copy of the cells current state</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">cell = row: </span><span class="nx">cell</span><span class="p">.</span><span class="nx">row</span><span class="p">,</span> <span class="nv">col: </span><span class="nx">cell</span><span class="p">.</span><span class="nx">col</span><span class="p">,</span> <span class="nv">live: </span><span class="nx">cell</span><span class="p">.</span><span class="nx">live</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>A living cell dies if it has less than two or greater than three living neighbors
A nonliving cell reproduces if it has exactly 3 living neighbors</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">live</span> <span class="o">or</span> <span class="nx">count</span> <span class="o">is</span> <span class="mi">3</span>
      <span class="nv">cell.live = </span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nx">count</span> <span class="o">&lt;</span> <span class="mi">4</span>
    <span class="nx">cell</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Count the living neighbors of a given cell by iterating around the clock
and checking each neighbor. The helper function isAlive allows for safely
checking without worrying about the boundaries of the world.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">countNeighbors: </span><span class="nf">(cell) -&gt;</span>
    <span class="nv">neighbors = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Iterate around each neighbor of the cell and check for signs of life.
If the neighbor is alive increment the neighbors counter.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">row</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">..</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">col</span> <span class="k">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">..</span><span class="mi">1</span><span class="p">]</span> <span class="k">when</span> <span class="p">(</span><span class="nx">row</span> <span class="o">or</span> <span class="nx">col</span><span class="p">)</span> <span class="o">and</span> <span class="nx">@isAlive</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">row</span> <span class="o">+</span> <span class="nx">row</span><span class="p">,</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">col</span> <span class="o">+</span> <span class="nx">col</span>
        <span class="o">++</span><span class="nx">neighbors</span>
    <span class="nx">neighbors</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Safely check if there is a living cell at the specified coordinates without
overflowing the bounds of the world</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">isAlive: </span><span class="nf">(row, col) -&gt;</span> <span class="o">!!</span><span class="nx">@world</span><span class="p">[</span><span class="nx">row</span><span class="p">]</span><span class="o">?</span><span class="p">[</span><span class="nx">col</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">live</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Iterate through the grid of the world and fire the passed in callback at
each location.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">travelWorld: </span><span class="nf">(callback) -&gt;</span>
    <span class="k">for</span> <span class="nx">row</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">@gridSize</span><span class="p">]</span>
      <span class="k">for</span> <span class="nx">col</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">@gridSize</span><span class="p">]</span>
        <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span> <span class="k">this</span><span class="p">,</span> <span class="nv">row: </span><span class="nx">row</span><span class="p">,</span> <span class="nv">col: </span><span class="nx">col</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Draw a given cell</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">draw: </span><span class="nf">(cell) -&gt;</span>
    <span class="nx">@context</span>  <span class="o">||=</span> <span class="nx">@createDrawingContext</span><span class="p">()</span>
    <span class="nx">@cellsize</span> <span class="o">||=</span> <span class="nx">@canvasSize</span><span class="err">/@gridSize</span>
    <span class="nv">coords = </span><span class="p">[</span><span class="nx">cell</span><span class="p">.</span><span class="nx">row</span> <span class="o">*</span> <span class="nx">@cellsize</span><span class="p">,</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">col</span> <span class="o">*</span> <span class="nx">@cellsize</span><span class="p">,</span> <span class="nx">@cellsize</span><span class="p">,</span> <span class="nx">@cellsize</span><span class="p">]</span>
    <span class="vi">@context.strokeStyle = </span><span class="nx">@lineColor</span>
    <span class="nx">@context</span><span class="p">.</span><span class="nx">strokeRect</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@context</span><span class="p">,</span> <span class="nx">coords</span>
    <span class="vi">@context.fillStyle = </span><span class="k">if</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">live</span> <span class="k">then</span> <span class="nx">@liveColor</span> <span class="k">else</span> <span class="nx">@deadColor</span>
    <span class="nx">@context</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@context</span><span class="p">,</span> <span class="nx">coords</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Create the canvas drawing context.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">createDrawingContext: </span><span class="o">-&gt;</span>
    <span class="nv">canvas        = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s1">&#39;canvas&#39;</span>
    <span class="nv">canvas.width  = </span><span class="nx">@canvasSize</span>
    <span class="nv">canvas.height = </span><span class="nx">@canvasSize</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">canvas</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span> <span class="s1">&#39;2d&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Start the game by creating a new GameOfLife instance. This function is
exported as a global.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nv">conway = </span><span class="nf">(options = {})-&gt;</span> <span class="k">new</span> <span class="nx">GameOfLife</span> <span class="nx">options</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 